### 系统架构概述

公司采用微服务架构，将不同业务项目按颗粒度进行拆分，并使用自动化工具进行代码部署和镜像管理。以下是整体架构的简洁梳理：

#### 1. **业务项目拆分**

- **SaaS业务**：包括全息画像、Wi-Fi画像、IP画像等，部署在 `saas` 空间下。

- **产品服务**：包含 `device-info`、`wifi-info` 等查数类服务，部署在 `yj` 空间下。

- **超管功能**：包括产品管理、账号体系管理、限次管理、权限管理、操作日志管理等，部署在 `spa` 空间下。

#### 2. **CI/CD与自动化流程**

- 每个业务项目通过自定义的 **shell 脚本** 实现自动化构建流程。

- **代码提交**：触发构建流程，自动打包成 Docker 镜像，并推送到私有 Docker Hub。

- **部署包**：生成部署包，并通过 **Helm** 工具进行部署。

- **镜像管理**：目标镜像由 Helm 拉取并部署至 Kubernetes 集群，配置同步至 **Consul**。

#### 3. **Kubernetes（K8s）集群与服务通信**

- 各微服务通过 **K8s 的 svc 服务** 进行通信。

- 流量链路由 **开发网** 打到目标机器（例如 `ga-k8s3`）。

- 在目标机器上，开放端口 **8060**，由 **Nginx** 进行流量转发。

#### 4. **Nginx与OpenResty网关**

- **Nginx** 在目标机器上负责接收请求，并转发到不同的服务。

- 在 `ga-k8s3` 上的 Nginx 将请求转发至 `yj` 空间下的 **apigate** 网关（使用 **OpenResty**），后者负责进一步转发请求。

- **OpenResty** 内置 Nginx 配置，转发请求至 `saas` 空间下的 **apigate**，再通过相应的服务（如 `saas` 下的服务）进行处理。

#### 5. **服务间链路**

- 每层架构通过 Nginx 和 OpenResty 配置层层转发，实现服务间的高效通信。

- Kubernetes 的服务发现机制确保不同空间的微服务能互相发现并通信。

---

此架构支持高效的业务拆分和微服务管理，确保了服务的灵活部署、自动化操作以及稳定的流量转发。
