### 风控统计数据排查与迁移

#### 背景

在进行风控统计时，主要关注正式用户的月活跃和日活跃数据，数据来源为操作日志（MySQL，亿级数据）。为提高查询效率，实施了分表策略，按月将数据存储到如`operation_log_YYYYMM`的表中，并使用并发控制（5个并发）和进度条来进行数据迁移。

#### 问题与排查

2023年4月后，日活跃数据正常，但早期数据偏少。排查发现，原有活跃用户识别逻辑是：只要有`user.login`行为即视为活跃。然而，很多用户在登录后第二天继续使用系统（通过cookie/session保持24小时有效），但未触发`user.login`，导致遗漏这些用户的活跃数据。

#### 解决方案

调整活跃用户识别逻辑：只要账户当天发生任何操作行为（包括非登录行为），即视为活跃用户。这样能有效避免漏算长期活跃的用户，确保数据准确。

#### 后续计划

将操作日志迁移至ClickHouse，提升数据聚合计算的效率，支持更高效的风控分析。
